:imagesdir: assets
:a2r-js: assets/deck.mjs
:a2r-css: assets/deck.css
:a2r-page-title: Asciidoc 2 Reveal.js
:a2r-favicon: assets/favicon.svg
:a2r-fragment-lists: true
:a2r-theme-name: dark-and-light-manual

= image:asciidoc-logo.svg[Asciidoc logo,role=thumb] => image:reveal-logo.png[Reveal.js logo,role=thumb]

A tale of how I converted asciidocs to single-page HTML presentations.

https://github.com/quilicicf/AsciidocToReveal[The code]

== Why?

* Power-point™ + emoji:penguin[] = emoji:sob[]
* Power-point™ is *heavy*
* Power-point™ is no standard
* I emoji:heart[] text

== Failed attempts

* Bundle a Reveal.js deck
** link:https://github.com/hakimel/reveal.js/issues/2524[Contributions to Reveal.js]
** link:https://api-domain-presentations.central.cloud.talend.com/[API presentations]
* Create Parcel transformer
* Use the official Asciidoc-Reveal plugin

[.notes]
====
* Bundling was mostly OK but no single-file, & still rather heavy
* Parcel transformer was not possible, no help from community
* The official plugin was opinionated in ways I don't like, mostly irrelevant Asciidoc document-based view. Like h1 doesn't create a proper slide.
====

== Features I wanted

* Input simpler than HTML
* Self-sufficient HTML output
* Smallest possible HTML output
* Speaker notes
* Layouts
* Code highlight
* Mermaid graphs
* My favorite boilerplate
* Emojis emoji:heart_eyes[]emoji:heart_eyes[1.2,em]emoji:heart_eyes[]
* CLI tool
* Parameterization
* Custom JS/CSS
* Light/dark themes
* Custom fonts `[COMING SOON]`

== How it's built

=== Process

[source,mermaid,role="graph graph-id-process"]
----
flowchart LR
    asciicode([Asciidoc Code])
    subgraph loa [Loop over AST]
        base1([AST])
        parseDeck([Deck + AST + DOM v1])
        insertFavicon([Deck + AST + DOM v2])
        insertTitleSection([Deck + AST + DOM v3])
        insertOtherSections([Deck + AST + DOM v4])
        embedImages([Deck + AST + DOM v5])
        embedEmojis([Deck + AST + DOM v6])
        fixupCodeBlocks([Deck + AST + DOM v7])
        extractSpeakerNotes([Deck + AST + DOM v8])
        fragmentLists([Deck + AST + DOM v9])
    end
    subgraph lod [Loop over DOM]
        base2([Deck + DOM v1])
        buildGraphs([Deck + DOM v2])
        highlightCode([Deck + DOM v3])
        applyLayouts([Deck + DOM v4])
        applyTheme([Deck + DOM v5])
        insertCustomFiles([Deck + DOM v6])
    end
    htmlCode([HTML code])
    minifiedHtmlCode([Minified code])
    gzippedHtmlCode([Gzipped code])

    asciicode --> |Create base DOM| loa
        base2 --> |Build graphs| buildGraphs
        buildGraphs --> |Highlight code| highlightCode
        highlightCode --> |Apply layouts| applyLayouts
        applyLayouts --> |Apply themes| applyTheme
        applyTheme --> |Insert custom files| insertCustomFiles
    loa --> lod
        base1 --> |Parse asciidoc| parseDeck
        parseDeck --> |Insert favicon| insertFavicon
        insertFavicon --> |Insert title section| insertTitleSection
        insertTitleSection --> |Insert other sections| insertOtherSections
        insertOtherSections --> |Embed images| embedImages
        embedImages --> |Embed emojis| embedEmojis
        embedEmojis --> |Fixup code blocks| fixupCodeBlocks
        fixupCodeBlocks --> |Extract speaker notes| extractSpeakerNotes
        extractSpeakerNotes --> |Fragment lists| fragmentLists
    lod --> |Generate HTML| htmlCode
    htmlCode --> |Minify| minifiedHtmlCode
    minifiedHtmlCode --> |Gzip| gzippedHtmlCode
----

[source,json,role="graph-animation graph-id-process"]
----
[
  { "selector": ".root .nodes .root:nth-of-type(2)", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 0 } },
  { "selector": "#L-asciicode-loa-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 0 } },
  { "selector": "*:not(.nodes)>.root>.edgeLabels>.edgeLabel:nth-of-type(3)", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 0 } },

  { "selector": ".root .nodes .root:nth-of-type(1)", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 1 } },
  { "selector": "#L-loa-lod-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 1 } },

  { "selector": "#flowchart-htmlCode-17", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "#L-lod-htmlCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "*:not(.nodes)>.root>.edgeLabels>.edgeLabel:nth-of-type(5)", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },

  { "selector": "#flowchart-minifiedHtmlCode-18", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "#L-htmlCode-minifiedHtmlCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "*:not(.nodes)>.root>.edgeLabels>.edgeLabel:nth-of-type(1)", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "#flowchart-gzippedHtmlCode-19", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "#L-minifiedHtmlCode-gzippedHtmlCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "*:not(.nodes)>.root>.edgeLabels>.edgeLabel:nth-of-type(2)", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } }
]
----

=== Architecture

[.layout-columns]
====
[.column-3x]
=====
=====

[.column-6x]
=====
[source,role="keep-markup"]
----
.
├── <span class="token tag">build-area</span>            <span class="dim"># Build cache</span>
├── <span class="token function">cli</span>                   <span class="dim"># CLI tool code</span>
├── <span class="token tag">dist</span>                  <span class="dim"># Built deck</span>
├── <span class="token string">lib</span>                   <span class="dim"># Base files for decks</span>
├── <span class="token function">src</span>                   <span class="dim"># Source files for a2r</span>
└── <span class="token string">test</span>                  <span class="dim"># Test presentation files</span>
----
=====
====

[.notes]
====
* Sources are read from the `test` folder
* The `lib` folder contains files that need some compilation (SASS -> CSS, JS bundling)
* The `src` folder contains the source code for `a2r`
* The `cli` folder contains the CLI wrapper for `a2r`
* The `build-area` folder contains pre-built parts of the configuration like emojis/graphs etc... to avoid re-fetching/-building immutable things
* The `dist` folder contains the final result
====

== Input simpler than HTML

* Needed a markup language
* Asciidoc > Markdown

== Self-sufficient HTML output

* Embed all dependencies (once)
* Including binary files!
* Solution: data-URIs!

[source,html,role=fragment]
--
<head>
  <title>My presentation</title>
  <style>
    .img-reveal-logo {
      display: inline-block;
      background-size: cover;
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQIAAA...');
    }
  </style>
</head>
<body>
  <span class="img-reveal-logo" style="width: 20px; height: 20px;"></span>
</body>
--

== Smallest possible HTML output

* Static HTML
* Minimal CSS & JS
* Minification

== Speaker notes

There are some notes on this slide!

[.notes]
====
* Aaaaaand
* They
* Are
* Here
====

== Layouts

1. Columns

=== Columns

[.layout-columns]
====
[.column-4x]
=====
* Twelve-parts column system
* Used with asciidoc blocks
=====

[source,asciidoc,role="column-8x"]
----
[.layout-columns]
=====
[.column-4x]
======
Left block, 4 spans
======
[.column-8x]
======
Right block, 8 spans
======
=====
----
====

== Code highlight

* Beautiful code
* Show line numbers
* Display code bit-by-bit

=== Code highlight - example

[source,mermaid,role="line-numbers keep-markup"]
----
flowchart LR
    <span class="fragment">toto[[This is some text]]</span>
    <span class="fragment">toto --> tata</span>
----

== Mermaid graphs

* Mermaid code => SVG graph
* Display bit-by-bit
* Support dark/light themes [COMING SOON]

=== Mermaid graphs - example

[.layout-columns]
====
[.column-8x]
=====
[source,mermaid]
----
flowchart LR
    subgraph AsciidocToReveal
        subgraph Mermaid
            mermaidCode[Mermaid code]
            svgCode[SVG code]
        end
        animationCode[JSON description of how to animate graph]
        animatedSvgCode[Animated graph]
    end

    mermaidCode:::input --> svgCode
    svgCode --> animatedSvgCode
    animationCode:::output --> animatedSvgCode
----

[source,json5]
----
[
  {
    "selector": "#AsciidocToReveal",
    "classes": [ "fragment" ],
    "attributes": { "data-fragment-index": 0 }
  },
  { "selector": "[id^=flowchart-mermaidCode-]", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 1 } },
  { "selector": "#L-mermaidCode-svgCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "[id^=flowchart-svgCode-]", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } }
  // etc...
]
----
=====

[.column-4x]
=====
[source,mermaid,role="graph graph-id-flowchart"]
----
flowchart LR
    subgraph AsciidocToReveal
        subgraph Mermaid
            mermaidCode[Mermaid code]
            svgCode[SVG code]
        end
        animationCode[JSON description of how to animate graph]
        animatedSvgCode[Animated graph]
    end

    mermaidCode:::input --> svgCode
    svgCode --> animatedSvgCode
    animationCode:::output --> animatedSvgCode
----

[source,json,role="graph-animation graph-id-flowchart"]
----
[
  { "selector": "#AsciidocToReveal", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 0 } },
  { "selector": "#Mermaid", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 0 } },

  { "selector": "[id^=flowchart-mermaidCode-]", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 1 } },

  { "selector": "#L-mermaidCode-svgCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },
  { "selector": "[id^=flowchart-svgCode-]", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 2 } },

  { "selector": "[id^=flowchart-animationCode-]", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 3 } },

  { "selector": "#L-svgCode-animatedSvgCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 4 } },
  { "selector": "#L-animationCode-animatedSvgCode-0", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 4 } },
  { "selector": "[id^=flowchart-animatedSvgCode-]", "classes": [ "fragment" ], "attributes": { "data-fragment-index": 4 } },
  { "selector": "#wtf" }
]
----
=====
====

== My favorite boilerplate

* Default styles & colors
* Deck-per-deck accent colors
* Reveal configuration via query parameters

== Emojis

* Asciidoctor extension
* SVGs fetched on the net
* Embedded like images

== CLI tool

* Commands `build` & `watch`
* Configuration `[COMING SOON]`

[source,role=fragment]
--
Usage: a2r <command> [options]

Commands:
  a2r build  Build an HTML presentation from an asciidoc presentation  [aliases: b]
  a2r watch  Watch a file containing an asciidoc presentation and convert it to an HTML presentation  [aliases: w]

Options:
  --help     Show help  [boolean]
  --version  Show version number  [boolean]

For more information, read the manual at https://github.com/quilicicf/AsciidocToReveal
--

== Parameterization

* Parameters prefixed with `a2r`
* Parsed into configuration once
* Used where needed
* Documented `[COMING SOON]`
* Validated `[COMING SOON]`

== Custom JS/CSS

[.layout-columns]
====
[.column-6x]
=====
* Custom JS with variable `a2r-js`
* Custom CSS with variable `a2r-css`
=====

[.column-6x]
=====
[source,asciidoc,role=fragment]
----
:a2r-js: assets/deck.mjs
:a2r-css: assets/deck.css

= Deck title

And here we go!
----
=====
====

== Light/dark themes

* Built-in themes
* Using Reveal.js framework
* Light/dark/choice
* Configurable accent color
* No fonts!

== Failed attempts

`[COMING SOON]`

== Q&A

So, did ya like it?
